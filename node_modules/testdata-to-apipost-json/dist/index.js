'use strict';

var trim = require('lodash/trim');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var trim__default = /*#__PURE__*/_interopDefaultLegacy(trim);

var isJSON = function (str) {
    if (typeof str === 'string') {
        try {
            var obj = JSON.parse(str);
            if (typeof obj === 'object' && obj) {
                return true;
            }
            else {
                return false;
            }
        }
        catch (e) {
            return false;
        }
    }
    else {
        return false;
    }
};
// 字符串转测试对象
var str2testData = function (str) {
    var returnList = [];
    var jsonObj;
    if (!isJSON(str)) {
        jsonObj = str.split(/((\r\n)|[\r\n])+/gi);
        var testDataheader = [];
        for (var x in jsonObj) {
            if (typeof jsonObj[x] !== 'string' || jsonObj[x].length <= 0) {
                continue;
            }
            var row = "".concat(jsonObj[x]);
            if (trim__default["default"](row).length <= 0) {
                continue;
            }
            var kv = jsonObj[x].split(',');
            if (x == '0') {
                testDataheader = kv;
            }
            else {
                var obj = {};
                for (var index = 0; index < testDataheader.length; index++) {
                    var name = String(testDataheader[index]);
                    if (!obj[name]) {
                        try {
                            if (kv[index]) {
                                obj[name] = String(kv[index]);
                            }
                            else {
                                obj[name] = '';
                            }
                        }
                        catch (error) {
                            obj[name] = '';
                        }
                    }
                }
                returnList.push(obj);
            }
        }
    }
    else {
        jsonObj = JSON.parse(str);
        if (jsonObj instanceof Array) {
            returnList = jsonObj;
        }
        else {
            returnList.push(jsonObj);
        }
    }
    return returnList;
};

module.exports = str2testData;
